<!-- Floating Toggle Button -->
<button type="button" (click)="togglePopup()"
    class="fixed bottom-5 right-5 bg-gradient-to-r from-indigo-500 to-purple-600 text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center text-3xl hover:scale-110 transition-all duration-300">
    üéß
</button>

<!-- Popup -->
<div class="fixed bottom-24 right-5 w-80 bg-white/90 backdrop-blur-xl shadow-2xl rounded-2xl p-5 transition-all duration-300 origin-bottom-right border border-white/40"
    [class.scale-0]="!isOpen" [class.opacity-0]="!isOpen" [class.translate-y-4]="!isOpen"
    [class.pointer-events-none]="!isOpen">
    <!-- Header -->
    <div class="flex justify-between items-center absolute -top-5 -left-4 p-2">
        <button type="button" (click)="togglePopup()"
            class="text-gray-400 hover:text-gray-700 text-6xl leading-none transition w-10 h-10 flex items-center justify-center rounded-full bg-white/80  backdrop-blur-lg shadow hover:rotate-90 transition-all duration-200 easy-linear">
            √ó
        </button>
    </div>

    <!-- Playlist -->
    <div class="mb-4 max-h-36 overflow-y-auto">
        <div *ngFor="let s of playlist; let i = index" (click)="playSong(i)"
            class="p-3 rounded-xl cursor-pointer mb-1 transition-all hover:bg-gray-100 flex items-center gap-3"
            [class.bg-indigo-100]="i === currentIndex">
            <div class="w-10 h-10 bg-indigo-500 text-white rounded-xl flex items-center justify-center">
                üé∂
            </div>
            <span class="font-medium text-gray-700">{{ s.title }}</span>
        </div>
    </div>

    <!-- Audio Element -->
    <audio #audioPlayer (timeupdate)="updateProgress()" (loadedmetadata)="updateProgress()"></audio>

    <!-- Controls -->
    <div class="flex justify-center items-center gap-6 mt-3">
        <button type="button" (click)="prev()"
            class="text-xl bg-gray-200 rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-300 active:scale-90 transition">
            ‚èÆ
        </button>

        <button type="button" (click)="togglePlay()"
            class="text-3xl bg-indigo-500 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:bg-indigo-600 active:scale-95 transition">
            {{ isPlaying ? '‚è∏' : '‚ñ∂Ô∏è' }}
        </button>

        <button type="button" (click)="next()"
            class="text-xl bg-gray-200 rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-300 active:scale-90 transition">
            ‚è≠
        </button>
    </div>

    <!-- Progress Bar -->
    <div class="flex items-center gap-2 text-sm mt-4">
        <span class="text-gray-500 w-10 text-right">{{ currentTime | number:'1.0-0' }}s</span>

        <input type="range" class="w-full accent-indigo-500 cursor-pointer" [value]="currentTime" [max]="duration"
            (input)="seek($event)" >

        <span class="text-gray-500 w-10">{{ formatTime(duration) }}s</span>
    </div>
</div>